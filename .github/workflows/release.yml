name: Maven Release

'on':
  release:
    types: [published]

jobs:
  publish:
    name: Build and Upload JARs
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: '21' # Make sure to set the correct Java version for your project
          distribution: temurin

      - name: Set maven project version
        run: mvn -B versions:set -DnewVersion=${{ github.event.release.tag_name }} -DgenerateBackupPoms=false

      - name: Build and package Maven project
        run: mvn clean package -DskipTests

      - name: Upload to release
        uses: softprops/action-gh-release@v1
        with:
          files: target/MinecraftServerAPI-${{ github.event.release.tag_name }}.jar
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload to Modrinth
        uses: dsx137/modrinth-release-action@main
        env:
          MODRINTH_TOKEN: ${{ secrets.MODRINTH_TOKEN }}
        with:
          name: ${{ github.event.release.tag_name }}
          project_id: H4i6sdRk
          loaders: spigot, paper, bukkit
          game_versions: 1.9:1.21.1
          version_number: ${{ github.event.release.tag_name }}
          files: |
            ./target/MinecraftServerAPI-${{ github.event.release.tag_name }}.jar
          changelog: ${{ github.event.release.body }}
          version_type: release # or beta, alpha
          featured: true
          status: 'listed' # or archived, draft, unlisted, scheduled, unknown
          requested_status: 'listed' # or archived, draft, unlisted
          updatable: false # default true, means updating existing version
          delete_old_files: false # default true

      - name: Upload to Modrinth
        uses: RubixDev/modrinth-upload@v1
        with:
          token: ${{ secrets.MODRINTH_TOKEN }}
          file_path: target/MinecraftServerAPI-${{ github.event.release.tag_name }}.jar
          name: ${{ github.event.release.tag_name }}
          version: ${{ github.event.release.tag_name }}
          game_versions: 1.9,1.9.1,1.9.2,1.9.3,1.9.4,1.10,1.10.2,1.11,1.11.1,1.11.2,1.12,1.12.1,1.12.2,1.13,1.13.2,1.14,1.14.1,1.14.2,1.14.3,1.14.4,1.15,1.15.1,1.15.2,1.16,1.16.1,1.16.2,1.16.3,1.16.4,1.16.5,1.17,1.17.1,1.18,1.18.1,1.18.2,1.19,1.19.1,1.19.2,1.19.3,1.19.4,1.20,1.20.1,1.20.2,1.20.3,1.20.4,1.20.5,1.20.6,1.21,1.21.1
          loaders: spigot,paper,bukkit
          featured: true
          project_id: H4i6sdRk


